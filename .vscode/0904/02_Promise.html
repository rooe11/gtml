<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promise</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGs03+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js"
    integrity="sha384-wfSDF2E50Y2D1uUdj003uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCEx130g8ifwB6"
    crossorigin="anonymous"></script>
    
    </head>
    <body>
    <button type="button" class="btn btn-outline-primary" onclick="time()">Promise</button>
    <button type="button" class="btn btn-outline-primary" onclick="promi()">Promise</button>
    <button type="button" class="btn btn-outline-primary" onclick="aj()">비동기 통신</button>
    <button type="button" class="btn btn-outline-primary" onclick="ay()">비동기 통신</button>

    <script src="/lib/jquery-3.7.1.js"></script>
    <script>
        //async
        async function ay() {

            async function ay() {
            let obj = {};

            //await 이 기능이 완전히 끝날 때 까지 기나려주는 기능.
            //Promise가 복잡해서, Promise를 단순하게 만드는 기능.
            //그래서 이 기능은 Promise가 적용 된 것만 사용이 가능. ★★★
            await $.ajax({
                url: 'http://localhost:3000/send1',
                type: 'post',
                data: JSON.stringify(obj),
                ontentType: 'application/json',
                success: function (res) {
                    console.log(res);

                    obj = res;
            },
        });
    }


resolve(res);

error: function (xhr, status, error) {
console.log('error');
reject(status);
        }



        //비동기 통신
        function aj() {
            let result = new Object(); //결과값을 보관하는 obj

            let obj = {name: '슈퍼맨' }; //ajax에 보내는 data
            console.log(obj);
            new Promise((resolve, reject) => {

                $.ajax({
            url: 'http://localhost:3000/send1',
            type: 'post',
            data: JSON.stringify(obj),
            contentType: 'application/json',
            success: function (res) {
                console.log(res);

                resolve = res;
            },
            error: function (xhr, status, error) {

            }
            }
        });
    })
        .then(result => {
            console.log('성공: ', result);
        })
        .then(result => {
            console.log('error: ', result);
        });

    </script>
    <script>
        function promi() {
            let pro = new Promise(function(ressole, reject) {
                console.log('동작 구현 부분');

                let check = true;
                //resolve 이 코드가 성공적으로 끝났을 때.
                tf(check) {
                    resolve('빨강색');
                }
                //reject 코드가 실패 혹은 error가 되었을 때.
                else{
                    reject('파랑색');
                }
            });

            pro
            //pro가 정상적으로 이행 됐을 때, then ( resovle로 함수넣으면, 이 함수가 실행 된다. )
            .then(result => {
                console.log(result);
        })
            .catch(result => {
                console.log(result);
            })

            .finally(() => {
                console.log( '무조건 실행');
            })

        }
        

        //DB 주고 받을 때, Database 연결하는 것도 비동기.
        //Primary key를 지정 안 한 상태라고 가정을 두겠습니다. ( swq도 없습니다. )
        //1, 2, 3, 4, 5 'IDX' 컬럼이 해당 기능을 제공.

        // 1. 해당 테이블의 'IDX'의 컬럼의 제일 마지막 번호를 갖고 와야 합니다.
        // SELECT MAX(IDX) FROM '테이블명';
        // 2. 1번행위가 끝나면, 1번의 결과값을 갖고, INSERT,

        //위의 행위를 비동기 진행 안 할 경우.
        // 1번을 시키고 안 기다리고, 2번 실행.

        function time() {
            setTimeout(function() {
                consle.log('set Time OUT');

                console.log('실행 영역');
            }, 1000);

            
        }
    </script>
</body>
</htm1>